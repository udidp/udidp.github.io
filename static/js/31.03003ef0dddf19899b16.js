webpackJsonp([31],{HABS:function(t,e){},jm4H:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("Xxa5"),a=i.n(s),n=i("exGp"),o=i.n(n),l=i("woOf"),c=i.n(l),r=i("bOdI"),d=i.n(r),p=i("g1m8"),h=i("aJka"),b=i("UQqG"),u=(i("rFtf"),i("1rPB")),f=i("2pnt"),m=i("XS7b"),v=i("BtOs"),g=i("0xDb"),S=i("xcTv"),_={name:"SubDomainSettings",data:function(){var t;return{domain:"",marketid:"",customedState:!1,openAppliedOperType:"",openAppliedTitle:"提示",openAppliedMsg:"您确定要关闭二级域名注册功能?",openAppliedDialogVisiable:!1,openAppliedState:!1,canCustomedSave:!1,ipv4:"",ipv6:"",ipv4Disabled:!0,ipState:!1,ipv6Disabled:!0,walletDisabled:!0,walletState:!1,extensionDisabled:!0,extensionState:!1,aliasDisabled:!0,aliasState:!1,extensionData:"",subUnitPrice:4,oriIsCustomed:!1,asset:{name:"",owner:"",hash:"",expire:null,openApplied:!1,isRoot:!1,isCustomed:!1,customPrice:4*Math.pow(10,18)},info:(t={signedDomain:"",name:"",owner:"",isRoot:"",expire:"",openApplied:!0,isCustomed:!1,isPureA:!1},d()(t,"isRoot",!1),d()(t,"rootHash",""),d()(t,"customPrice",0),t),dns:{ipv4:"",ipv6:"",wallet:"",extension:"",alias:""},dappState:{chainId:"",wallet:"",gasPrice:"",subGas:4*Math.pow(10,18),customedPriceGas:100*Math.pow(10,18)},dataChanged:!1}},components:{LoadingDot:p.a},computed:{showCustomedSaveText:function(){return this.canCustomedSave?this.$t("g.Saving"):this.$t("g.Update")},getMinUnitPrice:function(){return Object(g.y)(this.dappState.subGas,this.dappState.decimals)},customedDisabledClass:function(){return this.info.openApplied?"":"bas-disabled"},customPriceEnable:function(){return this.info.isCustomed&&this.info.openApplied&&!this.customedState},customedCheckEnabled:function(){return!this.info.openApplied||this.customedState},notSubDomain:function(){return!Object(b.f)(this.domain)},domainType:function(){return Object(b.b)(this.domain)},expireDate:function(){return Object(g.h)(this.info.expire,"YYYY-MM-DD HH:mm:ss")},ipv4Translate:function(){return Object(g.o)(this.info.ipv4)},ipv6Translate:function(){return Object(g.p)(this.info.ipv6)},getAllSaved:function(){return this.ipv4Disabled&&this.ipv6Disabled&&this.walletDisabled&&this.extensionDisabled&&this.aliasDisabled},externalBas:function(){return Object(g.y)(this.dappState.customedPriceGas)}},mounted:function(){var t=this;this.domain=this.$route.params.domain;var e=this.$store.getters["web3/dappState"],i=Object(u.g)();if(this.dappState=c()({},e,i),this.domain){var s=Object(g.m)(this.domain),a=new S.a;a.getDomainInfo(s).then(function(e){e.state&&(e=a.transData(e),t.dns=c()(t.dns,e.dns),t.asset=c()(t.asset,e.asset))}).catch(function(t){})}},methods:{checkAuthor:function(){var t=this.dappState.chainId,e=this.info.owner,i=this.dappState.wallet,s="当前网络不支持";return this.info.signedDomain?Object(h.b)(t)&&this.domain?!!Object(g.s)(e)||(s="请确认该域名: "+this.domain+" 属于前钱包["+i+"]账户下",this.$message(this.$basTip.error(s)),!1):(s="当前网络不支持",this.$message(this.$basTip.error(s)),!1):(s="信息不完整",this.$message(this.$basTip.error(s)),!1)},closeSubApply:function(){this.checkAuthor()?(this.openAppliedOperType="close",this.openAppliedDialogVisiable=!0):this.info.openApplied=!0},openSubApply:function(){this.checkAuthor()?(this.openAppliedOperType="open",this.openAppliedDialogVisiable=!0):this.info.openApplied=!1},cancelOpenApplied:function(){this.openAppliedDialogVisiable=!1},connfirmOpenApplied:function(){var t=this,e=this.info.signedDomain,i=this.dappState.wallet,s=Object(f.b)();"open"===this.openAppliedOperType?(this.openAppliedMsg="您确定要开启二级域名注册功能?",this.info.isCustomed=!1,this.info.openApplied=!1,this.openAppliedState=!0,s.methods.openToPublic(e).send({from:i}).then(function(e){t.info.openApplied=!0,t.openAppliedState=!1}).catch(function(e){t.openAppliedState=!1,t.info.openApplied=!1}),this.openAppliedDialogVisiable=!1):(this.openAppliedMsg="您确定要关闭二级域名注册功能?",this.openAppliedState=!0,s.methods.closeToPublic(e).send({from:i}).then(function(e){t.info.openApplied=!1,t.subUnitPrice=Object(g.y)(t.dappState.subGas,t.dappState.decimals),t.openAppliedState=!1}).catch(function(e){t.openAppliedState=!1,t.info.openApplied=!0}),this.openAppliedDialogVisiable=!1)},setCustomed:function(){var t=this;return o()(a.a.mark(function e(){var i,s,n,o,l,c,r,d,p,h,b,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.info.openApplied&&t.canCustomedSave){e.next=4;break}return i="设置自定义价格,必须先开启二级域名注册",t.$message(t.$basTip.error(i)),e.abrupt("return");case 4:if(!t.checkAuthor()){e.next=40;break}if(t.customedState=!t.customedState,s=t.info.signedDomain,n=t.dappState.wallet,o=Object(f.b)(),l=!1,(c=t.info.isCustomed)!==t.oriIsCustomed&&(l=!0),r=Object(g.y)(t.info.customPrice),parseInt(t.subUnitPrice)!==parseInt(r)&&(l=!0),l){e.next=18;break}return e.abrupt("return");case 18:if(!c){e.next=37;break}return Object(g.y)(t.dappState.customedPriceGas),d=t.subUnitPrice*Math.pow(10,18),p=t.dappState.customedPriceGas+"",e.next=24,Object(m.a)(n);case 24:return h=e.sent,e.next=27,Object(v.b)(n);case 27:if(b=e.sent,u=b._address){e.next=31;break}throw new EvalError("no oann address");case 31:t,t.customedState=!0,h.methods.approve(u,p).send({from:n}).then(function(t){return!0}).then(function(e){b.methods.openCustomedPrice(s,d+"").send({from:n}).then(function(e){t.customedState=!1}).catch(function(e){t.customedState=!1})}).catch(function(e){t.customedState=!1}),e.next=39;break;case 37:t.customedState=!0,o.methods.closeCustomedPrice(s).send({from:n}).then(function(e){e.status?t.oriIsCustomed=!1:t.info.isCustomed=!0,t.customedState=!1}).catch(function(e){t.customedState=!1});case 39:t.canCustomedSave=!1;case 40:case"end":return e.stop()}},e,t)}))()},getOptions:function(){return{from:this.dappState.wallet,gasPrice:this.dappState.gasPrice}},singleSetting:function(t){var e=this.dappState.wallet;if(Object(g.s)(this.info.owner))switch(t){case"ipv4":this.ipv4Set();break;case"ipv6":this.ipv6Set();break;case"wallet":this.walletSet();break;case"extension":this.extensionSet();break;case"alias":this.aliasSet()}else this.$alert("请确认"+this.domain+" 在您当前登录钱包["+e+" ]帐户下")},ipv4Set:function(){var t=this;if(this.ipv4Disabled)this.ipv4Disabled=!this.ipv4Disabled;else{var e=Object(f.b)(),i=this.ipv4||"0.0.0.0",s=this.ipv6||"::";if(i&&!Object(g.A)(i))return void this.$message(this.$basTip.error(i+" illegal"));if(s&&!Object(g.B)(s))return void this.$message(this.$basTip.error(s+" illegal"));e&&this.info.signedDomain&&(this.ipState=!0,e.methods.setIP(this.info.signedDomain,Object(g.b)(i),Object(g.c)(s)).send(this.getOptions()).then(function(e){t.ipState=!1,t.$message(t.$basTip.warn("Success"))}).catch(function(e){t.ipState=!1,t.$message(t.$basTip.error("fail"))})),this.ipv4Disabled=!this.ipv4Disabled}},ipv6Set:function(){var t=this;if(this.ipv6Disabled)this.ipv6Disabled=!this.ipv6Disabled;else{var e=Object(f.b)(),i=this.ipv4||"0.0.0.0",s=this.ipv6||"::";if(i&&!Object(g.A)(i))return void this.$message(this.$basTip.error(i+" illegal"));if(s&&!Object(g.B)(s))return void this.$message(this.$basTip.error(s+" illegal"));e&&this.info.signedDomain&&(this.ipState=!0,e.methods.setIP(this.info.signedDomain,Object(g.b)(i),Object(g.c)(s)).send(this.getOptions()).then(function(e){t.ipState=!1,t.$message(t.$basTip.warn("Success"))}).catch(function(e){t.ipState=!1,t.$message(t.$basTip.error("fail"))})),this.ipv6Disabled=!this.ipv6Disabled}},walletSet:function(){var t=this;if(this.walletDisabled)this.walletDisabled=!this.walletDisabled;else{var e=Object(f.b)();e&&this.info.signedDomain&&Object(g.z)(this.dns.wallet)&&(this.walletState=!0,e.methods.setBCAddress(this.info.signedDomain,this.dns.wallet||"").send(this.getOptions()).then(function(e){t.walletState=!1,t.$message(t.$basTip.warn("Success"))}).catch(function(e){t.walletState=!1,t.$message(t.$basTip.error("fail"))})),this.walletDisabled=!this.walletDisabled}},extensionSet:function(){var t=this;if(this.extensionDisabled)this.extensionDisabled=!this.extensionDisabled;else{var e=Object(f.b)();if(e&&this.info.signedDomain){this.extensionState=!0;var i=Web3.utils.toHex(this.extensionData||"");e.methods.setOpData(this.info.signedDomain,i).send(this.getOptions()).then(function(e){t.extensionState=!1,t.$message(t.$basTip.warn("Success"))}).catch(function(e){t.extensionState=!1,t.$message(t.$basTip.error("fail"))})}this.extensionDisabled=!this.extensionDisabled}},aliasSet:function(){var t=this;if(this.aliasDisabled)this.aliasDisabled=!this.aliasDisabled;else{var e=Object(f.b)();e&&this.info.signedDomain&&(this.aliasState=!0,e.methods.setAlias(this.info.signedDomain,this.dns.alias||"").send(this.getOptions()).then(function(e){t.aliasState=!1,t.$message(t.$basTip.warn("Success"))}).catch(function(e){t.aliasState=!1,t.$message(t.$basTip.error("fail"))})),this.aliasDisabled=!this.aliasDisabled}},settingAll:function(){var t=this.$store.state.web3.wallet;t.toUpperCase()===this.info.owner.toUpperCase()?this.setAllDisabledState(!1):this.$alert("请确认"+this.domain+" 在您当前登录钱包["+t+" ]帐户下")},saveAll:function(){var t=this,e=this.$store.state.web3.wallet;if(e.toUpperCase()===this.info.owner.toUpperCase()){var i=Object(f.b)();if(i&&this.info.signedDomain){var s=this.ipv4||"0.0.0.0",a=this.ipv6||"::";if(s&&!Object(g.A)(s))return void this.$message(this.$basTip.error(s+" illegal"));if(a&&!Object(g.B)(a))return void this.$message(this.$basTip.error(a+" illegal"));this.setAllState(!0);var n=Web3.utils.toHex(this.extensionData||"");i.methods.setRecord(this.info.signedDomain,Object(g.b)(s),Object(g.c)(a),this.info.wallet||"",n,this.info.alias||"").send(this.getOptions()).then(function(e){t.setAllState(!1),t.$message(t.$basTip.warn("Success"))}).catch(function(e){t.setAllState(!1),t.$message(t.$basTip.error("fail"))})}this.setAllDisabledState(!0)}else this.$alert("请确认"+this.domain+" 在您当前登录钱包["+e+" ]帐户下")},setAllState:function(t){this.ipState=t,this.walletState=t,this.aliasState=t,this.extensionState=t},setAllDisabledState:function(t){this.ipv4Disabled=t,this.ipv6Disabled=t,this.walletDisabled=t,this.extensionDisabled=t,this.aliasDisabled=t},setDNSManagerData:function(){this.$message(this.$basTip.warn("Come soon."))},customedPriceChanged:function(t){this.subUnitPrice;var e=Object(g.y)(this.info.customPrice);this.info.isCustomed&&parseInt(t)!==parseInt(e)?this.canCustomedSave=!0:this.canCustomedSave=!1},customedCheckedChange:function(t){var e=this.oriIsCustomed;this.canCustomedSave=e!==t}}},D={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container bg-white"},[i("div",{staticClass:"row justify-content-center align-content-center"},[i("el-card",{staticClass:"col-md-8 col-sm-10 box-card bas-domaininfo--card bas-gray-bg",attrs:{shadow:"never","body-style":"backgroup:rgba(245,246,246,1);"}},[i("div",{attrs:{label:"域名"}},[i("div",{staticClass:"clearfix item domain-info-inline"},[i("div",{staticClass:"domain-info-caption"},[t._v("域名 "+t._s(t.domain))]),t._v(" "),i("div",{staticClass:"domain-info-type"},[i("span",[t._v(t._s(t.$t("g."+t.domainType)))])])])]),t._v(" "),i("div",{staticClass:"domain-info-inline"},[i("div",{staticClass:"bas-info-label"},[i("span",[t._v("所有者")])]),t._v(" "),i("div",{staticClass:"bas-form-text"},[t._v("\n          "+t._s(t.info.owner)+"\n        ")])]),t._v(" "),i("div",{staticClass:"domain-info-inline"},[i("div",{staticClass:"bas-info-label"},[i("span",[t._v("到期日期")])]),t._v(" "),i("div",{staticClass:"bas-form-text"},[t._v("\n          "+t._s(t.expireDate)+"\n        ")])]),t._v(" "),i("div",{staticClass:"domain-info-inline"},[i("div",{staticClass:"bas-info-label"},[i("span",[t._v("域名Hash")])]),t._v(" "),i("div",{staticClass:"bas-form-text"},[t._v("\n          "+t._s(t.info.name)+"\n        ")])]),t._v(" "),t.info.isRoot?t._e():i("div",{staticClass:"domain-info-inline"},[i("div",{staticClass:"bas-info-label"},[i("span",[t._v("根域名Hash")])]),t._v(" "),i("div",{staticClass:"bas-form-text"},[t._v("\n          "+t._s(t.info.rootHash)+"\n        ")])])])],1),t._v(" "),t.notSubDomain?i("div",{staticClass:"row justify-content-center align-content-center"},[t._m(0)]):t._e(),t._v(" "),t.notSubDomain?i("div",{staticClass:"row justify-content-center align-content-center"},[i("el-form",{staticClass:"col-md-8 col-sm-10",attrs:{"label-width":"80"}},[i("el-form-item",{attrs:{label:"是否开放二级域名注册"}},[[i("el-radio-group",{model:{value:t.info.openApplied,callback:function(e){t.$set(t.info,"openApplied",e)},expression:"info.openApplied"}},[i("el-radio",{attrs:{label:!1},on:{change:t.closeSubApply}},[t._v("否")]),t._v(" "),i("el-radio",{attrs:{label:!0},on:{change:t.openSubApply}},[t._v("是")])],1),t._v(" "),t.openAppliedState?i("loading-dot",{staticStyle:{float:"right"}}):t._e()]],2),t._v(" "),i("el-form-item",{attrs:{label:"二级域名价格"}},[i("el-input-number",{attrs:{name:"subUnitPrice",precision:2,step:1,"controls-position":"right",disabled:!t.customPriceEnable,min:t.getMinUnitPrice},on:{change:t.customedPriceChanged},model:{value:t.subUnitPrice,callback:function(e){t.subUnitPrice=e},expression:"subUnitPrice"}}),t._v(" "),i("el-checkbox",{staticClass:"bas-domain--setprice-tip",attrs:{disabled:t.customedCheckEnabled},on:{change:t.customedCheckedChange},model:{value:t.info.isCustomed,callback:function(e){t.$set(t.info,"isCustomed",e)},expression:"info.isCustomed"}},[t._v("\n          Notice: 如开启自定义价格，将额外收取"+t._s(t.externalBas)+"BAS\n        ")]),t._v(" "),i("a",{staticClass:"bas-link bas-link-settings",class:t.customedDisabledClass,on:{click:t.setCustomed}},[t._v("\n          "+t._s(t.showCustomedSaveText)+"\n        ")]),t._v(" "),t.customedState?i("loading-dot",{staticStyle:{float:"right"}}):t._e()],1)],1),t._v(" "),i("el-dialog",{attrs:{visible:t.openAppliedDialogVisiable,title:t.openAppliedTitle,"before-close":t.cancelOpenApplied,width:"30%"}},[i("span",{staticClass:"text-center"},[t._v(t._s(t.openAppliedMsg))]),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.cancelOpenApplied()}}},[t._v("\n          取 消\n        ")]),t._v(" "),i("el-button",{staticClass:"bas-btn-primary",attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.connfirmOpenApplied()}}},[t._v("\n          确 定\n        ")])],1)])],1):t._e(),t._v(" "),t._e(),t._v(" "),t.notSubDomain?i("div",{staticClass:"row justify-content-center align-content-center"},[i("div",{staticClass:"bas-split-h",staticStyle:{width:"90%","border-top":"1px solid rgba(150, 150, 166, 1)"}})]):t._e(),t._v(" "),i("div",{staticClass:"row justify-content-center align-content-center"},[i("div",{staticClass:"col-md-8 col-sm-10",staticStyle:{padding:"0.5rem 0"}},[i("div",{staticClass:"bas-refs-header"},[t._m(1),t._v(" "),i("div",[t.getAllSaved?i("a",{staticClass:"btn btn-sm bas-btn-primary",staticStyle:{width:"100px"},on:{click:t.settingAll}},[t._v("\n            "+t._s(t.$t("g.Update"))+"\n          ")]):t._e(),t._v(" "),t.getAllSaved?t._e():i("a",{staticClass:"btn btn-sm bas-btn-primary",staticStyle:{width:"100px"},on:{click:t.saveAll}},[t._v("\n            "+t._s(t.$t("g.Saving"))+"\n          ")])])])])]),t._v(" "),i("div",{staticClass:"row justify-content-center align-content-center"},[i("el-form",{staticClass:"col-md-8 col-sm-10",attrs:{"label-width":"100px"}},[i("el-form-item",{attrs:{label:"IPV4"}},[i("el-input",{staticStyle:{width:"60%"},attrs:{disabled:t.ipv4Disabled},model:{value:t.ipv4,callback:function(e){t.ipv4=e},expression:"ipv4"}}),t._v(" "),i("a",{staticClass:"bas-link bas-link-settings",on:{click:function(e){return t.singleSetting("ipv4")}}},[t._v("\n          "+t._s(t.ipv4Disabled?t.$t("g.Update"):t.$t("g.Saving"))+"\n        ")]),t._v(" "),t.ipState?i("loading-dot",{staticStyle:{float:"right"}}):t._e()],1),t._v(" "),i("el-form-item",{attrs:{label:"IPV6"}},[i("el-input",{staticStyle:{width:"60%"},attrs:{disabled:t.ipv6Disabled},model:{value:t.ipv6,callback:function(e){t.ipv6=e},expression:"ipv6"}}),t._v(" "),i("a",{staticClass:"bas-link bas-link-settings",on:{click:function(e){return t.singleSetting("ipv6")}}},[t._v("\n          "+t._s(t.ipv6Disabled?t.$t("g.Update"):t.$t("g.Saving"))+"\n        ")]),t._v(" "),t.ipState?i("loading-dot",{staticStyle:{float:"right"}}):t._e()],1),t._v(" "),i("el-form-item",{attrs:{label:"区块链地址"}},[i("el-input",{staticStyle:{width:"60%"},attrs:{disabled:t.walletDisabled},model:{value:t.dns.wallet,callback:function(e){t.$set(t.dns,"wallet",e)},expression:"dns.wallet"}}),t._v(" "),i("a",{staticClass:"bas-link bas-link-settings",on:{click:function(e){return t.singleSetting("wallet")}}},[t._v("\n          "+t._s(t.walletDisabled?t.$t("g.Update"):t.$t("g.Saving"))+"\n        ")]),t._v(" "),t.walletState?i("loading-dot",{staticStyle:{float:"right"}}):t._e()],1),t._v(" "),i("el-form-item",{attrs:{label:"别名"}},[i("el-input",{staticStyle:{width:"60%"},attrs:{disabled:t.aliasDisabled},model:{value:t.dns.alias,callback:function(e){t.$set(t.dns,"alias",e)},expression:"dns.alias"}}),t._v(" "),i("a",{staticClass:"bas-link bas-link-settings",on:{click:function(e){return t.singleSetting("alias")}}},[t._v("\n          "+t._s(t.aliasDisabled?t.$t("g.Update"):t.$t("g.Saving"))+"\n        ")]),t._v(" "),t.aliasState?i("loading-dot",{staticStyle:{float:"right"}}):t._e()],1),t._v(" "),i("el-form-item",{attrs:{label:"附加信息"}},[i("el-input",{staticStyle:{width:"60%"},attrs:{type:"textarea",autosize:"",disabled:t.extensionDisabled},model:{value:t.dns.extrainfo,callback:function(e){t.$set(t.dns,"extrainfo",e)},expression:"dns.extrainfo"}},[i("template",{slot:"append"},[i("loading-dot")],1)],2),t._v(" "),i("a",{staticClass:"bas-link bas-link-settings",on:{click:function(e){return t.singleSetting("extension")}}},[t._v("\n          "+t._s(t.extensionDisabled?t.$t("g.Update"):t.$t("g.Saving"))+"\n        ")]),t._v(" "),t.extensionState?i("loading-dot",{staticStyle:{float:"right"}}):t._e()],1)],1)],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"col-md-8 col-sm-10",staticStyle:{padding:"0.5rem 0"}},[e("div",{staticClass:"bas-refs-header"},[e("div",[e("h5",[this._v("二级域名配置")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("h5",[this._v("映射数据配置")])])}]};var C=i("VU/8")(_,D,!1,function(t){i("HABS")},null,null);e.default=C.exports}});
//# sourceMappingURL=31.03003ef0dddf19899b16.js.map