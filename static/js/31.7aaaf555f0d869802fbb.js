webpackJsonp([31],{WV5i:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("Xxa5"),i=a.n(s),n=a("exGp"),o=a.n(n),r=a("woOf"),c=a.n(r),u=a("UQqG"),l=a("A77I"),p=a("rFtf"),m=a("0xDb"),d={name:"DomainRegist",data:function(){return{domain:"",unitPrice:20,years:1,openState:"1",domainType:"",subUnitPrice:4,customedCheck:!1,commitTop:{openApplied:!1,isCustomed:!1,customedPrice:4},topData:{domain:"",owner:"",expire:"",openApplied:!0,isCustomed:!1,customedPrice:4},error:"",configs:{decimals:18,rareGas:5e3,topGas:20,subGas:4,customedPriceGas:100,maxYearReg:5},ruleState:{}}},mounted:function(){var t=this.$route.params.domain;this.domain=t||"",this.domainType=Object(l.h)(t);var e=this.$store.getters["web3/ruleState"];this.ruleState=c()({},e);var a=this.$store.getters["web3/getOANNConfigs"];this.subUnitPrice=a.subGas,this.configs=c()({},this.configs,a)},computed:{getSubGasWarn:function(){return"最低不能少于"+this.configs.subGas+" BAS."},showSubGasWarn:function(){return this.customedCheck&&this.subUnitPrice<=4},showSubConfig:function(){return"subdomain"!==Object(l.i)(this.domain)},showTopDomainInfo:function(){return!!this.topData.owner},getDomainTypeShow:function(){if(!this.domain)return"";var t=Object(l.i)(this.domain);return this.$t("g."+t)},showRootInfo:function(){return this.openState},getTotal:function(){var t=this.years*this.unitPrice;return this.customedCheck&&this.openState?t+this.configs.customedPriceGas:t},subUnitPriceEnable:function(){return!this.openState},getTopExpireDate:function(){return this.topData.expire?Object(m.h)(this.topData.expire):""}},methods:{topExist:function(){return this.topData.owner&&this.topData.expire},queryDomain:function(t){this.$store.getters.metaMaskDisabled&&!t||(queryDomainByName(t).then(function(t){t.state}).catch(function(t){}),Object(u.f)(t))},resetTopData:function(t){this.topData.owner="",this.topData.expire="",this.topData.openApplied=!0,this.topData.isCustomed=!1,this.topData.customedPrice=t||this.configs.subGas},setSubUnitPrice:function(t){this.subUnitPrice=t},domainChanged:function(t){var e=this;if(Object(u.a)(t))this.domainType="illegal";else if(this.domainType=Object(l.i)(t),Object(u.f)(t)){this.unitPrice=this.configs.subGas;var a=Object(u.d)(t);this.topData.domain=a;a&&Object(p.c)(a).then(function(t){t.state?(e.topData.expire=t.data.expire,e.topData.owner=t.data.owner,e.topData.openApplied=t.data.openApplied,e.topData.isCustomed=t.data.isCustomed,e.topData.customedPrice=t.data.customedPrice,t.data.openApplied&&t.data.isCustomed&&t.data.customedPrice&&(e.unitPrice=t.data.customedPrice)):e.resetTopData()}).catch(function(t){e.resetTopData()})}else this.unitPrice=Object(u.e)(t)?this.configs.rareGas:this.configs.topGas,this.resetTopData()},setDomainType:function(t){this.domainType=Object(l.i)(t)},gotoWhois:function(){this.topData.domain&&(this.$store.getters.metaMaskDisabled?this.$metamask():this.$router.push({path:"/domain/detail/"+this.topData.domain}))},openSubApply:function(){this.openState&&(this.subUnitPrice=this.topData.customedPrice)},closeSubApply:function(){this.openState||(this.subUnitPrice=this.configs.subGas)},registing:function(){var t=this;return o()(i.a.mark(function e(){var a,s,n,o,r,c,d,b,h,f,v,g,_;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a="",t.domain||(a="域名为空,"+t.$t("g.illegal"),t.$message(t.$basTip.error(a))),s=Object(m.l)(t.domain),"illegal"!=(n=Object(l.i)(s))){e.next=8;break}return a=t.domain+" "+t.$t("g.illegal"),t.$message(t.$basTip.error(a)),e.abrupt("return");case 8:if(!t.$store.getters.metaMaskDisabled){e.next=11;break}return t.$metamask(),e.abrupt("return");case 11:return o=t.$store.getters["web3/dappState"],e.next=14,Object(p.f)(s);case 14:if(!(r=e.sent).exist||!r.owner){e.next=18;break}return t.$message(t.$basTip.error(t.domain+"域名已存在,请选用其他域名注册!")),e.abrupt("return");case 18:"subdomain"===n?(c=Object(u.c)(s),d={fullDomain:s,domain:c.domain,topDomain:c.top,year:t.years},t.registSub(d,o.basBal,18)):(b=t.configs.decimals||18,h=t.subUnitPrice*Math.pow(10,b),t.domain,f=Boolean(t.openState),v=!!t.customedCheck,g=t.years,_=o.wallet,t.registTop(s,f,v,h,g,_,b));case 19:case"end":return e.stop()}},e,t)}))()},registTop:function(t,e,a,s,i,n,o){var r=this;Object(p.b)(t,a,i,n).then(function(n){if(n.isValid){n.basBalance;if(Object(m.i)(n.basBalance,n.cost,o)){var c={isSubdomain:!1,costWei:n.cost,domain:t,openApplied:e,isCustomed:a,customPriceWei:s,year:i};r.$router.push({name:"domain.newtopregisting",params:{commitData:c}})}else{var u=r.$t("g.LackOfBasBalance");r.$message(r.$basTip.error(u))}}else r.$message(r.$basTip.error("预估校验未通过"))}).catch(function(t){})},registSub:function(t,e,a){t.fullDomain;var s=t.domain,i=t.topDomain,n=t.year,o=this;this.$store.state.web3.basBal;Object(p.a)(n,s,i).then(function(t){var r=t.cost;if(Object(m.i)(e,r,a)){var c={isSubdomain:!0,costWei:t.cost,domain:s,topDomain:i,year:n};o.$router.push({name:"domain.newregisting",params:{commitData:c}})}else{var u=o.$t("g.LackOfBasBalance");o.$message(o.$basTip.warn(u))}}).catch(function(t){})}},watch:{domain:function(t){var e=this;setTimeout(function(){e.domainChanged(t)},1e3)}}},b={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("div",{staticClass:"row justify-content-center"},[a("div",{staticClass:"col-7 bas-card"},[t._m(0),t._v(" "),a("div",{staticClass:"bas-gray-split"}),t._v(" "),a("div",{staticClass:"bas-card__body bas-border-none"},[a("el-form",{staticClass:"col-10",attrs:{"label-width":"160px"}},[a("el-form-item",{attrs:{label:"域名"}},[a("el-input",{staticClass:"bas-regist--domain-input",attrs:{placeholder:"please enter domain..."},model:{value:t.domain,callback:function(e){t.domain=e},expression:"domain"}},[a("template",{slot:"append"},[t._v(t._s(t.getDomainTypeShow))])],2),t._v(" "),t.topData.openApplied?t._e():a("div",{staticClass:"bas-text-warning"},[a("i",{staticClass:"fa fa-warning"}),t._v("\n              此根域名暂不支持二级域名注册，根域名所有者未开放注册权限\n            ")])],1),t._v(" "),t._e(),t._v(" "),a("el-form-item",{attrs:{label:"价格"}},[a("span",[t._v(" "+t._s(t.unitPrice)+" ")]),t._v(" "),a("span",[t._v(" BAS/year ")])]),t._v(" "),t.showSubConfig?a("el-form-item",{attrs:{label:"是否开放二级域名注册"}},[[a("el-radio",{attrs:{label:""},on:{change:t.closeSubApply},model:{value:t.openState,callback:function(e){t.openState=e},expression:"openState"}},[t._v("否")]),t._v(" "),a("el-radio",{attrs:{label:"1"},on:{change:t.openSubApply},model:{value:t.openState,callback:function(e){t.openState=e},expression:"openState"}},[t._v("是")])]],2):t._e(),t._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.showSubConfig&&!!t.openState,expression:"showSubConfig && !!openState"}],attrs:{label:"二级域名价格",error:t.getSubGasWarn,"show-message":t.customedCheck}},[a("el-input-number",{attrs:{name:"subUnitPrice",precision:2,step:1,"controls-position":"right",disabled:!this.customedCheck,min:t.configs.subGas},model:{value:t.subUnitPrice,callback:function(e){t.subUnitPrice=e},expression:"subUnitPrice"}}),t._v(" "),a("el-checkbox",{staticClass:"bas-domain--setprice-tip",model:{value:t.customedCheck,callback:function(e){t.customedCheck=e},expression:"customedCheck"}},[t._v("\n              Notice: 如开启自定义价格，将额外收取"+t._s(t.configs.customedPriceGas)+"BAS\n            ")])],1),t._v(" "),a("div"),t._v(" "),a("el-form-item",{attrs:{label:"购买期限"}},[a("el-input-number",{attrs:{name:"years","controls-position":"right",min:1,max:t.configs.maxYearReg},model:{value:t.years,callback:function(e){t.years=e},expression:"years"}}),t._v(" "),a("span",[t._v("Year")])],1)],1),t._v(" "),t.showTopDomainInfo?a("div",{staticClass:"bas-regist--topdomain-container"},[a("h5",{},[t._v("根域名信息")]),t._v(" "),a("div",{staticClass:"bas-inline-flex"},[a("div",{staticClass:"bas-label-100"},[t._v("到期日期:")]),t._v(" "),a("span",[t._v(t._s(t.getTopExpireDate))])]),t._v(" "),a("div",{staticClass:"bas-inline-flex"},[a("div",{staticClass:"bas-label-100"},[t._v("所有者:")]),t._v(" "),a("span",[t._v(t._s(this.topData.owner))]),t._v(" "),a("a",{staticClass:"bas-link bas-small",staticStyle:{"margin-left":"1.5rem"},on:{click:function(e){return e.preventDefault(),t.gotoWhois.apply(null,arguments)}}},[t._v("\n              Who is >>\n            ")])])]):t._e(),t._v(" "),a("div",{staticClass:"col-12 text-center"},[a("span",{staticClass:"bas-text-green"},[t._v("总计:")]),t._v(" "),a("h2",{staticClass:"d-inline bas-text-green"},[t._v(t._s(t.getTotal))]),t._v(" "),a("span",{staticClass:"bas-text-green"},[t._v("BAS")]),t._v(" "),a("div",{staticClass:"bas-card__footer"},[a("button",{staticClass:"btn w-25 bas-btn-primary",on:{click:t.registing}},[t._v("\n              注册\n            ")])])])],1)])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"bas-card__header"},[e("div",{staticClass:"bas-card__header-title"},[this._v("注册域名")])])}]};var h=a("VU/8")(d,b,!1,function(t){a("w8bu")},null,null);e.default=h.exports},w8bu:function(t,e){}});
//# sourceMappingURL=31.7aaaf555f0d869802fbb.js.map